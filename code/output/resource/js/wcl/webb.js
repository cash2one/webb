!function(){if(WCL&&WCL.globalLogFlag&&WCL.did&&WCL.lid&&(WCL.pathHTTP&&WCL.pathHTTPS||WCL.productID)){var t=function(){this.start=null,this.debug=!1,this.dataStore={},this.t=null,this.cycle=null,this.MIN_SPEED=2e3,this.MAX_SPEED=1e4,this.curSpeed=5e3,this.stayTime=0,this.MAX_LEN=2e3,this.storeLen=-1,this.MAX_SEND=100,this.hostEnum={SESTAT:0},this.keyMap={input:0,disp:0,view:0,user:0,heart:0},this.hostAddr=[-1===location.protocol.indexOf("https")?WCL.pathHTTP||"http://sestat.baidu.com/owb.gif?":WCL.pathHTTPS||"https://sp1.baidu.com/5b1ZeDe5KgQFm2e88IuM_a/owb.gif?"],this.commLog={},this.isFirst=!0,this.sendNum={},this.init()};$.extend(t.prototype,{setCommLog:function(t,e,i){if(!WCL)return!1;if(!(t in this.commLog)){var n={};e&&i?(n.log=e,n.len=i):(n.log="&pid="+(WCL.productID||0),n.log+="&qid="+WCL.lid+"&did="+WCL.did,n.len=(n.log+"&t="+(new Date).getTime()).length),this.commLog[t]=n}return!0},preInit:function(){this.start=(new Date).getTime(),this.cycle=null,null!==this.t&&clearTimeout(this.t),this.t=null,this.storeLen=-1;var t=WCL&&WCL.lid?WCL.lid:"";t&&(this.setCommLog(t),this.sendNum[t]=0)},flushData:function(t){null!==this.t&&(clearTimeout(this.t),this.t=null);var e=this.fetchData(t,!0);this.startSend(e,!0)},init:function(){var t=this;t.preInit(),$(window).on("unload",function(){WCL&&1===WCL.globalLogFlag&&t.flushData(2)})},send:function(t,e,i){if(!t)return!1;this.debug;var n="",s="",o="";if("object"==typeof t){for(var h in t)n=t[h],"object"==typeof n&&(n=JSON.stringify(n)),s+=h+"="+encodeURIComponent(n)+"&";s=s.substring(0,s.length-1)}else"string"==typeof t&&(s=t);if(!i&&WCL&&WCL.lid&&(i=WCL.lid),!(i&&i in this.commLog))return!1;if(s+=this.commLog[i].log,s+="&t="+(new Date).getTime(),("number"!=typeof e||0>e||e>=this.hostAddr.length)&&(e=0),o=this.hostAddr[e]+s,o.length>this.MAX_LEN)return!1;var r=window["BD_PS_C"+(new Date).getTime()]=new Image;return r.src=this.hostAddr[e]+s,!0},sendNow:function(t,e,i){if(t&&"string"==typeof t&&t in this.keyMap&&e){var n="type=3&fm="+t+"&data="+encodeURIComponent(JSON.stringify([e]));i&&i.qid&&i.log&&i.len?(this.setCommLog(i.qid,i.log,i),this.send(n,this.keyMap[t],i.qid)):this.send(n,this.keyMap[t])}},pushData:function(t,e,i){var n=WCL&&WCL.lid?WCL.lid:"";if(!n)return!1;i&&i.qid&&i.log&&i.len?(this.setCommLog(i.qid,i.log,i.len),n=i.qid):this.setCommLog(n),n in this.dataStore||(this.dataStore[n]={});var s=this.dataStore[n];t in s||(s[t]=[[],[]]),i&&i.level===!0?s[t][0].push(encodeURIComponent(JSON.stringify(e))):s[t][1].push(encodeURIComponent(JSON.stringify(e)))},fetchData:function(t,e){function i(){for(var e,i=0,n=[],o=!1,d=this.commLog[l].len,c=this.hostAddr[r].length,f=c+("type="+t+"&fm="+u+"&data=").length+d,g=f+6,p=g;0!==s.length&&i<this.MAX_SEND;)a===!1&&0===t&&i++,e=s.shift(),n.push(e),p=g+e.length+3,(g>=this.MAX_LEN||p>=this.MAX_LEN)&&(n.length>=2&&(n.pop(),o=!0),h.push({qid:l,key:u,type:t,data:"%5B"+n.join("%2C")+"%5D",host:r}),n=[],o&&(n[0]=e,o=!1),p=n.length>0?f+3+e.length+3:f+6),g=p;n.length>0&&h.push({qid:l,key:u,type:t,data:"%5B"+n.join("%2C")+"%5D",host:r})}var n,s,o=this.dataStore,h=[],r=0,a=!1,d=WCL&&WCL.lid?WCL.lid:"";if(!d)return[];for(var l in o){a=l!==d?!0:!1,n=o[l];for(var u in n)u in this.keyMap&&(r=this.keyMap[u],"number"==typeof r&&void 0!==this.hostAddr[r]&&(s=n[u][0].length>0?n[u][0]:n[u][1],i.call(this),(a===!0||e!==!0)&&0===s.length&&n[u][1].length>0&&(s=n[u][1],i.call(this)),a===!0&&delete this.dataStore[l]))}return h},startSend:function(t,e){var i,n,s=this,o=100;if(e)for(var h=0;h<t.length;h++){if(i=t.shift(),!(i&&i.qid&&i.qid in s.commLog))return;n="type="+i.type+"&fm="+i.key+"&data="+i.data,s.send(n,i.host,i.qid)}else var r=setInterval(function(){return t.length<=0?void clearInterval(r):(i=t.shift(),void(i&&i.qid&&i.qid in s.commLog&&(n="type="+i.type+"&fm="+i.key+"&data="+i.data,s.send(n,i.host,i.qid),i.qid in s.sendNum&&(s.sendNum[i.qid]+=1))))},o)},startCycle:function(){var t=this;null===t.cycle&&(t.cycle=1),t.t=setTimeout(function(){var e=t.fetchData(0),i=e.length;-1===t.storeLen&&(t.storeLen=i),0!==t.storeLen&&i/t.storeLen>=2&&t.curSpeed>t.MIN_SPEED&&(t.curSpeed-=1e3),(0===i||t.storeLen/i>=2)&&t.curSpeed<t.MAX_SPEED&&(t.curSpeed+=1e3),t.startSend(e,0),t.startCycle()},t.curSpeed)},sendPack:function(t,e,i){t&&"string"==typeof t&&t in this.keyMap&&e&&(this.pushData(t,e,i),null===this.cycle&&this.startCycle())}}),"function"==typeof define&&define.amd?define("wcl/webb",["require"],function(){return t}):WCL.Webb=new t}}();